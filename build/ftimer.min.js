if("undefined"==typeof exports)var exports=window||{};var ft;!function(t){function e(t,e){return void 0===t&&(t=20),new o(t,e)}var s={NONE:0,ACTIVE:1,EXECUTING:2,DISPOSED:3},i={GET:0,DELAY:1,INTERVAL:2,THEN:3},n={GCStep:1500},o=function(){function t(t,e){void 0===e&&(e=n),this.items=[],this.interval=0,this.state=s.ACTIVE,this.count=0;var i=this.execute.bind(this);this.opts=e,this.interval=setInterval(i,t)}return t.prototype.execute=function(){t.now=Date.now(),this.count++,this.items.forEach(function(e){e.state===s.ACTIVE&&e.nextExecution<t.now&&e.execute()}),this.count%this.opts.GCStep===0&&(this.items=this.items.filter(function(t){return t.state!=s.DISPOSED}))},t.prototype.get=function(t,e){if(this.state===s.DISPOSED)throw"TimerManages is disposed";e=e||("string"==typeof t?t:null)||"t"+Math.round(1e10*Math.random()).toString(36);var i=new r(e,t);return this.items.push(i),i},t.prototype.dispose=function(){this.state=s.DISPOSED,clearInterval(this.interval)},t.now=Date.now(),t}();t.TimerManager=o;var r=function(){function t(t,e){this.startTime=+new Date,this.result=!0,this._value=null,this.forward=!0,this.looped=!1,this.name=t,this.context=e,this.taskIndex=-1,this.tasks=[],this.state=s.NONE}return Object.defineProperty(t.prototype,"now",{get:function(){return o.now},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeFromStart",{get:function(){return+new Date-this.startTime},enumerable:!0,configurable:!0}),t.prototype.val=function(t){return this.value(t),this},t.prototype.value=function(t){return void 0!==t&&(this._value=t,this.result?this.tryPromise():this.tryNext()),this._value},t.prototype.delay=function(t){return this.tasks.push({type:i.DELAY,time:t}),this.tryNext(),this},t.prototype.interval=function(t,e,s){return void 0===e&&(e=0),this.tasks.push({type:i.INTERVAL,time:t,count:e,executed:0,handler:s}),this.tryNext(),this},t.prototype.then=function(t,e){return this.tasks.push({type:i.THEN,time:0,value:[t,e]}),this.tryNext(),this},t.prototype.getTask=function(){return this.tasks[this.taskIndex]},t.prototype.isActive=function(){return this.state===s.ACTIVE},t.prototype.getNext=function(){var t=this.taskIndex+(this.forward?1:-1),e=this.tasks.length;return t=this.looped&&0>t?e-1:t,t=this.looped&&t>=e?0:t},t.prototype.hasNext=function(){return this.looped||(this.forward?this.tasks.length&&this.taskIndex+1<this.tasks.length:this.taskIndex-1>=0)},t.prototype.tryNext=function(){!this.isActive()&&this.hasNext()&&(this.taskIndex=this.getNext(),this.state=s.ACTIVE,this.nextExecution=this.now+this.getTask().time)},t.prototype.start=function(){return this.state=s.ACTIVE,this},t.prototype.reverse=function(){this.forward=!1,this.state=s.ACTIVE,this.nextExecution=this.now+this.tasks[this.taskIndex].time},t.prototype.loop=function(){return this.looped=!0,this.tryNext(),this},t.prototype.unloop=function(){return this.looped=!1,this},t.prototype.stop=function(){return this.state=s.NONE,this},t.prototype.execute=function(){var t,e,n,o,r=this.tasks[this.taskIndex];switch(this.state=s.EXECUTING,r.type){case i.THEN:t=r.value[0],e=r.value[1],this.result?(n=t instanceof Function,o=n?t.apply(this.context,this.value()):t,this.value(o||null)):(n=e instanceof Function,o=n?e.apply(this.context,this.value):e,this.value(o||null));break;case i.DELAY:this.tryNext();break;case i.INTERVAL:r.executed=r.executed+(this.forward?1:-1),r.handler&&r.handler instanceof Function&&r.handler.apply(this.context,this.value),this.forward&&r.count>0&&r.executed>=r.count?this.tryNext():!this.forward&&r.executed<=0?this.tryNext():(this.nextExecution=this.now+this.tasks[this.taskIndex].time,this.state=s.ACTIVE)}},t.prototype.tryPromise=function(){this._value&&this._value.then?this._value.then(this.promiseResolve,this.promiseReject):this.tryNext()},t.prototype.promiseResolve=function(t){this.value(t)},t.prototype.promiseReject=function(t){this.result=!1,this.value(t)},t.prototype.dispose=function(){this.state=s.DISPOSED,this.tasks.forEach(function(t){t.handler&&delete t.handler}),this.context=null},t}();t.Timer=r,t.getTimerManager=e,t.timer=t.getTimerManager(20)}(ft=exports.ft||(exports.ft={})),exports.ftimer=ft.timer;